# Copyright (C) Pipin Fitriadi - All Rights Reserved

# Unauthorized copying of this file, via any medium is strictly prohibited
# Proprietary and confidential
# Written by Pipin Fitriadi <pipinfitriadi@gmail.com>, 28 August 2024

stages: [Test]
Code Quality:
  stage: Test
  image: pipelinecomponents/flake8
  variables:
    PIP_ROOT_USER_ACTION: ignore
  before_script:
    - pip install --upgrade pip
    - pip install flake8-bandit flake8-black flake8-bugbear flake8-isort
  script:
    - flake8
Dags Import Check:
  stage: Test
  rules:
    - if: |
        $CI_COMMIT_TAG ||
        $CI_COMMIT_BRANCH == 'main'
      exists:
        - airflow/dags/**/dag_*.py
      changes:
        - airflow/dags/**/dag_*.py
  image:
    name: apache/airflow:slim-2.3.4-python3.8
    entrypoint: [""]
    docker:
      user: airflow
  variables:
    AIRFLOW__CORE__DAGS_FOLDER: airflow/dags/
  before_script:
    - airflow db init
  script:
    - if ERRORS=$(airflow dags list-import-errors) && echo "$ERRORS" && [[ $ERRORS != 'No data found' ]]; then exit 1; fi
